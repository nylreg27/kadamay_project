template/family

family_list
{% extends 'base.html' %}

{% block title %}Family List - Kadamay Mortuary System{% endblock %}

{% block content %}
<div class="card bg-base-100 shadow-xl p-4 md:p-6 text-base-content rounded-xl my-4 mx-auto max-w-6xl">
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-3">
        <h1 class="text-2xl font-extrabold text-primary">Families</h1>
        
        <div class="flex flex-col md:flex-row items-stretch md:items-center gap-2 w-full md:w-auto">
            <form action="{% url 'family:family_list' %}" method="GET" class="flex flex-grow md:flex-grow-0" id="searchForm">
                <input
                    type="text"
                    name="search"
                    placeholder="Search families..."
                    value="{{ request.GET.search }}"
                    class="input input-bordered input-sm w-full rounded-r-none"
                    id="searchInput"
                    aria-label="Search families"
                />
                <button
                    type="submit"
                    class="btn btn-primary btn-sm rounded-l-none"
                    aria-label="Submit search"
                >
                    <i data-feather="search" class="w-4 h-4"></i>
                </button>
            </form>
            
            {% if request.GET.search %}
            <a href="{% url 'family:family_list' %}"
               class="btn btn-outline btn-primary btn-sm flex items-center gap-2 tooltip tooltip-bottom" {# Updated classes here #}
               data-tip="Clear Search"
               aria-label="Clear search and refresh list"
            >
                <i data-feather="refresh-cw" class="w-4 h-4"></i> Refresh {# Added text #}
            </a>
            {% endif %}

            {% if user.is_superuser %}
            <a href="{% url 'family:family_create' %}"
               class="btn btn-primary btn-sm w-full md:w-auto flex items-center gap-2 transition-all duration-300 hover:scale-105"
               aria-label="Add new family"
            >
              <i data-feather="plus" class="w-4 h-4"></i> Add Family
            </a>
            {% endif %}
        </div>
    </header>

    {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
                <div class="alert 
                    {% if message.tags == 'success' %}alert-success
                    {% elif message.tags == 'warning' %}alert-warning
                    {% elif message.tags == 'error' %}alert-error
                    {% else %}alert-info
                    {% endif %} shadow-lg mb-2">
                    <div>
                        <i data-feather="info" class="w-6 h-6"></i>
                        <span>{{ message }}</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="flex gap-2 mb-4">
        <a href="#" id="viewFamilyBtn" class="btn btn-info btn-square tooltip btn-sm" data-tip="View Selected" aria-label="View selected family" disabled>
            <i data-feather="eye" class="w-4 h-4"></i>
        </a>
        {% if user.is_superuser %}
        <a href="#" id="editFamilyBtn" class="btn btn-warning btn-square tooltip btn-sm" data-tip="Edit Selected" aria-label="Edit selected family" disabled>
            <i data-feather="edit" class="w-4 h-4"></i>
        </a>
        <a href="#" id="deleteFamilyBtn" class="btn btn-error btn-square tooltip btn-sm" data-tip="Delete Selected" aria-label="Delete selected family" disabled>
            <i data-feather="trash-2" class="w-4 h-4"></i>
        </a>
        {% endif %}
    </div>

    {% if families %}
        <div class="hidden md:block overflow-x-auto rounded-lg shadow-md border border-base-300">
            <table class="table table-zebra w-full table-sm">
                <thead>
                    <tr>
                        <th class="w-8"></th>
                        <th class="text-left text-xs font-semibold uppercase tracking-wider text-base-content/70">Family Name</th>
                        <th class="text-left text-xs font-semibold uppercase tracking-wider text-base-content/70">Head of Family</th>
                        <th class="text-left text-xs font-semibold uppercase tracking-wider text-base-content/70">Church</th>
                        <th class="text-left text-xs font-semibold uppercase tracking-wider text-base-content/70">Address</th>
                        <th class="text-left text-xs font-semibold uppercase tracking-wider text-base-content/70">Contact Number</th>
                    </tr>
                </thead>
                <tbody>
                    {% for family in families %}
                    <tr class="hover:bg-base-200 cursor-pointer" data-family-id="{{ family.id }}">
                        <td class="w-8">
                            <label class="label cursor-pointer justify-center p-0">
                                <input type="checkbox" name="selected_family" value="{{ family.id }}" class="checkbox checkbox-primary checkbox-xs family-checkbox" />
                            </label>
                        </td>
                        <td class="whitespace-nowrap text-xs">
                            <a href="{% url 'family:family_detail' family.id %}" class="link link-hover link-primary font-medium">
                                {{ family.family_name|upper }}
                            </a>
                        </td>
                        <td class="whitespace-nowrap text-xs">
                            {% if family.head_of_family %}
                                <a href="{% url 'individual:individual_detail' family.head_of_family.id %}" class="link link-hover link-secondary">
                                    {{ family.head_of_family.surname|upper }}, {{ family.head_of_family.given_name|upper }}
                                </a>
                            {% else %}
                                <span class="italic text-base-content/60">- None -</span>
                            {% endif %}
                        </td>
                        <td class="whitespace-nowrap text-xs">
                            {% if family.church %}
                                <a href="{% url 'church:church_detail' family.church.id %}" class="link link-hover link-accent">
                                    {{ family.church.name|upper }}
                                </a>
                            {% else %}
                                <span class="italic text-base-content/60">- No Church -</span>
                            {% endif %}
                        </td>
                        <td class="whitespace-nowrap text-xs">{{ family.address|default:"N/A" }}</td>
                        <td class="whitespace-nowrap text-xs">{{ family.contact_number|default:"N/A" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {# Mobile View (Updated for selection) #}
        <div class="md:hidden space-y-3">
            <div class="flex gap-2 mb-4">
                <a href="#" id="viewFamilyBtnMobile" class="btn btn-info btn-square tooltip btn-sm" data-tip="View Selected" aria-label="View selected family" disabled>
                    <i data-feather="eye" class="w-4 h-4"></i>
                </a>
                {% if user.is_superuser %}
                <a href="#" id="editFamilyBtnMobile" class="btn btn-warning btn-square tooltip btn-sm" data-tip="Edit Selected" aria-label="Edit selected family" disabled>
                    <i data-feather="edit" class="w-4 h-4"></i>
                </a>
                <a href="#" id="deleteFamilyBtnMobile" class="btn btn-error btn-square tooltip btn-sm" data-tip="Delete Selected" aria-label="Delete selected family" disabled>
                    <i data-feather="trash-2" class="w-4 h-4"></i>
                </a>
                {% endif %}
            </div>
            {% for family in families %}
            <div class="card bg-base-100 shadow-md rounded-lg p-3 flex items-center">
                <label class="label cursor-pointer justify-center p-0 mr-3">
                    <input type="checkbox" name="selected_family" value="{{ family.id }}" class="checkbox checkbox-primary checkbox-xs family-checkbox" />
                </label>
                <div class="flex-grow">
                    <h2 class="text-base font-semibold text-primary mb-1">
                        <a href="{% url 'family:family_detail' family.id %}" class="link link-hover">
                            {{ family.family_name|upper }}
                        </a>
                    </h2>
                    <div class="text-xs text-base-content/80 space-y-0.5">
                        <p><strong>Head:</strong> 
                            {% if family.head_of_family %}
                            <a href="{% url 'individual:individual_detail' family.head_of_family.id %}" class="link link-hover link-secondary">
                                {{ family.head_of_family.surname|upper }}, {{ family.head_of_family.given_name|upper }}
                            </a>
                            {% else %}
                            <span class="italic text-base-content/60">- None -</span>
                            {% endif %}
                        </p>
                        <p><strong>Church:</strong>
                            {% if family.church %}
                                <a href="{% url 'church:church_detail' family.church.id %}" class="link link-hover link-accent">
                                    {{ family.church.name|upper }}
                                </a>
                            {% else %}
                                <span class="italic text-base-content/60">- No Church -</span>
                            {% endif %}
                        </p>
                        <p><strong>Address:</strong> {{ family.address|default:"N/A" }}</p>
                        <p><strong>Contact:</strong> {{ family.contact_number|default:"N/A" }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if is_paginated %}
        <div class="flex justify-center mt-4">
            <div class="join join-sm">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="join-item btn btn-sm">«</a>
                {% else %}
                <button class="join-item btn btn-sm btn-disabled">«</button>
                {% endif %}

                <button class="join-item btn btn-sm">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</button>

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="join-item btn btn-sm">»</a>
                {% else %}
                <button class="join-item btn btn-sm btn-disabled">»</button>
                {% endif %}
            </div>
        </div>
        {% endif %}

    {% else %}
        <div class="hero bg-base-200 rounded-lg p-8 text-center shadow-lg border border-base-300">
            <div class="hero-content flex flex-col items-center">
                <i data-feather="users" class="w-16 h-16 text-base-content/50 mb-4"></i>
                <p class="text-lg font-bold mb-2 text-base-content">No families found.</p>
                <p class="text-sm text-base-content/80 mb-4">It looks like there are no families in the system yet. You can add one by clicking the button below.</p>
                {% if user.is_superuser %}
                <a href="{% url 'family:family_create' %}" class="btn btn-primary flex items-center gap-2 btn-sm">
                    <i data-feather="plus" class="w-4 h-4"></i> Add First Family
                </a>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        feather.replace();

        const searchInput = document.getElementById('searchInput');
        const searchForm = document.getElementById('searchForm');

        if (searchInput && searchForm) {
            searchInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    searchForm.submit();
                }
            });
        }

        // --- Handle Row Selection for Action Buttons ---
        const checkboxes = document.querySelectorAll('.family-checkbox');
        
        // Desktop Buttons
        const viewBtn = document.getElementById('viewFamilyBtn');
        const editBtn = document.getElementById('editFamilyBtn');
        const deleteBtn = document.getElementById('deleteFamilyBtn');

        // Mobile Buttons
        const viewBtnMobile = document.getElementById('viewFamilyBtnMobile');
        const editBtnMobile = document.getElementById('editFamilyBtnMobile');
        const deleteBtnMobile = document.getElementById('deleteFamilyBtnMobile');

        function updateActionButtons() {
            const checkedBoxes = document.querySelectorAll('.family-checkbox:checked');
            const selectedFamilyId = checkedBoxes.length === 1 ? checkedBoxes[0].value : null;

            const viewUrl = selectedFamilyId ? `{% url 'family:family_detail' 0 %}`.replace('0', selectedFamilyId) : '#';
            const editUrl = selectedFamilyId ? `{% url 'family:family_update' 0 %}`.replace('0', selectedFamilyId) : '#';
            const deleteUrl = selectedFamilyId ? `{% url 'family:family_delete' 0 %}`.replace('0', selectedFamilyId) : '#';

            function applyButtonState(viewB, editB, deleteB, isSuperuser) {
                if (viewB) {
                    if (selectedFamilyId) {
                        viewB.removeAttribute('disabled');
                        viewB.href = viewUrl;
                        
                        if (isSuperuser) {
                            if (editB) { editB.removeAttribute('disabled'); editB.href = editUrl; }
                            if (deleteB) { deleteB.removeAttribute('disabled'); deleteB.href = deleteUrl; }
                        }
                    } else {
                        viewB.setAttribute('disabled', 'disabled');
                        viewB.href = '#';
                        
                        if (isSuperuser) {
                            if (editB) { editB.setAttribute('disabled', 'disabled'); editB.href = '#'; }
                            if (deleteB) { deleteB.setAttribute('disabled', 'disabled'); deleteB.href = '#'; }
                        }
                    }
                }
            }

            applyButtonState(viewBtn, editBtn, deleteBtn, {% if user.is_superuser %}true{% else %}false{% endif %});
            applyButtonState(viewBtnMobile, editBtnMobile, deleteBtnMobile, {% if user.is_superuser %}true{% else %}false{% endif %});
        }

        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox !== this) {
                            otherCheckbox.checked = false;
                        }
                    });
                }
                updateActionButtons();
            });
        });

        const tableRows = document.querySelectorAll('tbody tr');
        tableRows.forEach(row => {
            row.addEventListener('click', function(event) {
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'A' || event.target.closest('a') || event.target.closest('label')) {
                    return; 
                }

                const checkbox = this.querySelector('.family-checkbox');
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                    if (checkbox.checked) {
                        checkboxes.forEach(otherCheckbox => {
                            if (otherCheckbox !== checkbox) {
                                otherCheckbox.checked = false;
                            }
                        });
                    }
                    updateActionButtons();
                }
            });
        });

        updateActionButtons();
    });
</script>
{% endblock %}

family_form

{# family_form.html #}
{% extends 'base.html' %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Create{% endif %} Family - Kadamay Mortuary System{% endblock %}

{% block content %}
<div class="card bg-base-100 shadow-xl p-6 md:p-8 text-base-content rounded-xl my-6 mx-auto max-w-4xl">
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <h1 class="text-3xl font-extrabold text-primary">{% if form.instance.pk %}Edit Family{% else %}Create New Family{% endif %}</h1>
        
        <a href="{% if form.instance.pk %}{% url 'family:family_detail' form.instance.pk %}{% else %}{% url 'family:family_list' %}{% endif %}" 
           class="btn btn-ghost flex items-center gap-2 transition-all duration-300 hover:scale-105 w-full md:w-auto">
            <i data-feather="arrow-left" class="w-5 h-5"></i> Back
        </a>
    </header>
    
    <form method="post" class="space-y-6">
        {% csrf_token %}
        
        {% if form.non_field_errors %}
        <div role="alert" class="alert alert-error mb-4"> {# DaisyUI alert #}
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <span>
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </span>
        </div>
        {% endif %}
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-control w-full"> {# DaisyUI form control #}
                <label class="label" for="{{ form.family_name.id_for_label }}">
                    <span class="label-text text-base-content/70">Family Name</span>
                </label>
                <input type="text" 
                       name="{{ form.family_name.name }}" 
                       id="{{ form.family_name.id_for_label }}" 
                       value="{{ form.family_name.value|default:'' }}" 
                       placeholder="e.g., Dela Cruz Family"
                       class="input input-bordered w-full {% if form.family_name.errors %}input-error{% endif %}"
                >
                {% if form.family_name.errors %}
                <label class="label">
                    <span class="label-text-alt text-error">{{ form.family_name.errors }}</span>
                </label>
                {% endif %}
            </div>

            <div class="form-control w-full"> {# DaisyUI form control #}
                <label class="label" for="{{ form.church.id_for_label }}">
                    <span class="label-text text-base-content/70">Church</span>
                </label>
                <select name="{{ form.church.name }}" 
                        id="{{ form.church.id_for_label }}" 
                        class="select select-bordered w-full {% if form.church.errors %}select-error{% endif %}">
                  <option value="" disabled selected>Select Church</option> {# Disabled and selected for placeholder #}
                    {% for church_id, church_name in form.fields.church.choices %}
                        {% if church_id %} {# Ensure value is not empty string for valid options #}
                        <option value="{{ church_id }}" {% if form.church.value|stringformat:"s" == church_id|stringformat:"s" %}selected{% endif %}>{{ church_name }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
                {% if form.church.errors %}
                <label class="label">
                    <span class="label-text-alt text-error">{{ form.church.errors }}</span>
                </label>
                {% endif %}
            </div>
        </div>

        <div class="form-control w-full"> {# DaisyUI form control #}
            <label class="label" for="{{ form.address.id_for_label }}">
                <span class="label-text text-base-content/70">Address</span>
            </label>
            <textarea name="{{ form.address.name }}" 
                      id="{{ form.address.id_for_label }}" 
                      rows="3" 
                      placeholder="e.g., 123 Main St, Anytown"
                      class="textarea textarea-bordered h-24 w-full {% if form.address.errors %}textarea-error{% endif %}">{{ form.address.value|default:'' }}</textarea>
            {% if form.address.errors %}
            <label class="label">
                <span class="label-text-alt text-error">{{ form.address.errors }}</span>
            </label>
            {% endif %}
        </div>

        <div class="form-control"> {# DaisyUI form control for checkbox #}
            <label class="label cursor-pointer justify-start gap-3"> {# Align checkbox and label #}
                <input type="checkbox" 
                       name="{{ form.is_active.name }}" 
                       id="{{ form.is_active.id_for_label }}" 
                       {% if form.is_active.value %}checked{% endif %} 
                       class="checkbox checkbox-primary"
                >
                <span class="label-text text-base-content">Is Active</span>
            </label>
            {% if form.is_active.errors %}
            <label class="label">
                <span class="label-text-alt text-error">{{ form.is_active.errors }}</span>
            </label>
            {% endif %}
        </div>

        <div class="flex justify-end space-x-3 mt-8"> {# Increased top margin #}
            <a href="{% if form.instance.pk %}{% url 'family:family_detail' form.instance.pk %}{% else %}{% url 'family:family_list' %}{% endif %}" 
               class="btn btn-ghost transition-all duration-300 hover:scale-105">
                Cancel
            </a>
            <button type="submit" 
                    class="btn btn-primary transition-all duration-300 hover:scale-105">
                {% if form.instance.pk %}Update Family{% else %}Create Family{% endif %}
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        feather.replace();
    });
</script>
{% endblock %}

family_detail
{# apps/family/templates/family/family_detail.html #}
{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-base-content">{{ family.family_name }} Details</h1>
        <div class="space-x-2">
            <a href="{% url 'family:family_update' family.pk %}" class="btn btn-warning btn-outline btn-sm">
                <i data-feather="edit" class="w-4 h-4"></i> Edit Family
            </a>
            <a href="{% url 'family:family_list' %}" class="btn btn-ghost btn-sm">
                <i data-feather="arrow-left" class="w-4 h-4"></i> Back to List
            </a>
        </div>
    </div>

    {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
                <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %} shadow-lg">
                    <div>
                        <i data-feather="{% if message.tags == 'success' %}check-circle{% else %}alert-circle{% endif %}" class="w-6 h-6"></i>
                        <span>{{ message }}</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-primary">Family Information</h2>
                <div class="text-base-content/80">
                    <p class="mb-2"><strong class="text-base-content">Name:</strong> {{ family.family_name }}</p>
                    <p class="mb-2"><strong class="text-base-content">Address:</strong> {{ family.address }}</p>
                    <p class="mb-2"><strong class="text-base-content">Church:</strong> <a href="{% url 'church:church_detail' family.church.pk %}" class="link link-hover link-info">{{ family.church.name }}</a></p>
                    <p class="mb-2"><strong class="text-base-content">Status:</strong>
                        <span class="badge {% if family.is_active %}badge-success{% else %}badge-error{% endif %} badge-md">
                            {% if family.is_active %}Active{% else %}Inactive{% endif %}
                        </span>
                    </p>
                    {% if family.in_charge %}
                        <p class="mb-2"><strong class="text-base-content">In Charge:</strong> {{ family.in_charge.full_name }}</p>
                    {% else %}
                        <p class="mb-2"><strong class="text-base-content">In Charge:</strong> Not assigned</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-primary">Key Metrics</h2>
                <div class="stats stats-vertical lg:stats-horizontal shadow mb-6">
                    <div class="stat">
                        <div class="stat-title">Total Members</div>
                        <div class="stat-value">{{ total_members_count }}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">Active Members</div>
                        <div class="stat-value text-success">{{ active_members_count }}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">Deceased Members</div>
                        <div class="stat-value text-error">{{ deceased_members_count }}</div>
                    </div>
                </div>

                {% if family_head %}
                    <p class="text-lg font-semibold mb-4">Family Head: <span class="text-primary">{{ family_head.given_name }} {{ family_head.surname }}</span></p>
                {% else %}
                    <p class="text-base-content/70 mb-4">No Family Head designated yet.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-body">
            <h2 class="card-title text-primary">Family Members</h2>
            {% if total_members_count > 0 %}
                <div class="overflow-x-auto">
                    <table class="table w-full">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Relationship</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for individual in all_individuals %}
                                <tr>
                                    <td><a href="{% url 'individual:individual_detail' individual.pk %}" class="link link-hover link-primary">{{ individual.full_name }}</a></td>
                                    <td>{{ individual.get_relationship_display_value }}</td> {# Use the display value #}
                                    <td>
                                        <span class="badge {% if individual.is_active_member %}badge-success{% else %}badge-error{% endif %} badge-md">
                                            {% if individual.is_active_member %}ACTIVE{% else %}INACTIVE{% endif %}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="flex gap-1">
                                            <a href="{% url 'individual:individual_detail' individual.pk %}" class="btn btn-xs btn-info btn-square tooltip" data-tip="View Member">
                                                <i data-feather="eye" class="w-4 h-4"></i>
                                            </a>
                                            <a href="{% url 'individual:individual_update' individual.pk %}" class="btn btn-xs btn-warning btn-square tooltip" data-tip="Edit Member">
                                                <i data-feather="edit-3" class="w-4 h-4"></i>
                                            </a>
                                            {# Add delete button if needed #}
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 text-right">
                    <a href="{% url 'individual:family_individual_create' family.pk %}" class="btn btn-primary btn-md">
                        <i data-feather="plus-circle" class="w-5 h-5"></i> Add New Member
                    </a>
                </div>
            {% else %}
                <div class="alert alert-info shadow-lg mt-6">
                    <div>
                        <i data-feather="info" class="w-6 h-6"></i>
                        <span>This family currently has no registered members.</span>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <a href="{% url 'individual:family_individual_create' family.pk %}" class="btn btn-primary btn-md">
                        <i data-feather="plus-circle" class="w-5 h-5"></i> Add First Member
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title text-primary">Recent Payments by Family Members</h2>
            {% if family_payments %}
                <div class="overflow-x-auto">
                    <table class="table w-full">
                        <thead>
                            <tr>
                                <th>Individual</th>
                                <th>Amount</th>
                                <th>Date Paid</th>
                                <th>Payment Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in family_payments %}
                                <tr>
                                    <td><a href="{% url 'individual:individual_detail' payment.individual.pk %}" class="link link-hover link-primary">{{ payment.individual.full_name }}</a></td>
                                    <td>{{ payment.amount|floatformat:2 }}</td>
                                    <td>{{ payment.date_paid|date:"M j, Y" }}</td>
                                    <td>{{ payment.get_payment_type_display }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-warning shadow-lg mt-6">
                    <div>
                        <i data-feather="alert-triangle" class="w-6 h-6"></i>
                        <span>No recent payments found for this family.</span>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    feather.replace();
</script>
{% endblock %}

family_confirm_delete

{# family_confirm_delete.html #}
{% extends 'base.html' %}

{% block title %}Confirm Delete - {{ family.family_name|upper }} - Kadamay Mortuary System{% endblock %}

{% block content %}
<div class="card bg-base-100 shadow-xl p-6 md:p-8 text-base-content max-w-4xl mx-auto my-6 rounded-xl">

    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <h1 class="text-3xl font-extrabold text-error">Confirm Family Deletion</h1>
        <a href="{% url 'family:family_detail' family.id %}"
           class="btn btn-ghost flex items-center gap-2 transition-all duration-300 hover:scale-105">
            <i data-feather="arrow-left" class="w-5 h-5"></i> Back to Details
        </a>
    </header>

    <section class="alert alert-warning mb-10 shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-8 w-8" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
        <div>
            <h2 class="text-xl font-bold">Warning: Irreversible Action!</h2>
            <p class="text-lg leading-relaxed text-base-content/90">
                Are you absolutely sure you want to delete the family "<strong class="font-bold">{{ family.family_name|upper }}</strong>"? <br>
                This action <span class="underline font-extrabold text-error">cannot be undone</span> and will permanently remove:
            </p>
        </div>
    </section>

    <section class="mb-10">
        <h3 class="text-2xl font-semibold mb-4 border-b-2 border-base-300 pb-2 text-base-content/90">Family Details</h3>
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
            <div>
                <dt class="font-medium text-base-content/70">Family Name</dt>
                <dd class="mt-1 text-lg font-semibold text-base-content">{{ family.family_name|upper }}</dd>
            </div>
            <div>
                <dt class="font-medium text-base-content/70">Church Affiliation</dt>
                <dd class="mt-1 text-lg font-semibold text-base-content">
                    {% if family.church %}
                        <a href="{% url 'church:church_detail' family.church.id %}" class="link link-primary">{{ family.church.name|upper }}</a>
                    {% else %}
                        N/A
                    {% endif %}
                </dd>
            </div>
            <div class="md:col-span-2">
                <dt class="font-medium text-base-content/70">Address</dt>
                <dd class="mt-1 text-lg font-semibold text-base-content">{{ family.address|upper }}</dd>
            </div>
        </dl>
    </section>

    <section class="alert alert-info mb-12 shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <div>
            <h3 class="text-xl font-bold">Associated Data to be Removed</h3>
            <ul class="list-disc list-inside space-y-2 text-lg font-medium text-base-content/90">
                <li><strong class="text-xl font-extrabold text-info">{{ family.individual_set.count }}</strong> Members</li>
                <li>All associated payments and related records for these members.</li>
            </ul>
        </div>
    </section>

    <form method="post" class="flex justify-end space-x-4">
        {% csrf_token %}
        <a href="{% url 'family:family_detail' family.id %}"
           class="btn btn-ghost transition-all duration-300 hover:scale-105">
            Cancel
        </a>
        <button type="submit"
                class="btn btn-error transition-all duration-300 hover:scale-105">
            Confirm Delete
        </button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        feather.replace();
    });
</script>
{% endblock %}